# Запуск симуляторів — покрокова інструкція

## 0. Встановити залежності (один раз)

```
pip install -r F:\auto_telemetry\simulators\requirements.txt
```

---

## 1. Запустити симулятори (три окремі термінали)

Кожен симулятор займає термінал і працює поки його не зупинити (Ctrl+C).

**Термінал 1 — ET-7017 модуль №1:**
```
python F:\auto_telemetry\simulators\et7017_simulator.py 5020 1
```

**Термінал 2 — ET-7017 модуль №2:**
```
python F:\auto_telemetry\simulators\et7017_simulator.py 5021 1
```

**Термінал 3 — ET-7284 (лічильник + частота):**
```
# Аргументи: порт unit_id PPM
# PPM = 1000 — кількість імпульсів на 1 метр (відповідає seed_dev.sql)
python F:\auto_telemetry\simulators\et7284_simulator.py 5022 1 1000
```

---

## 2. Перевірити що порти відкриті

В четвертому терміналі:

```
netstat -an | findstr "5020 5021 5022"
```

Очікуваний результат — три рядки зі станом `LISTENING`:
```
TCP    0.0.0.0:5020    0.0.0.0:0    LISTENING
TCP    0.0.0.0:5021    0.0.0.0:0    LISTENING
TCP    0.0.0.0:5022    0.0.0.0:0    LISTENING
```

Якщо рядків немає — симулятор не запущено або упав з помилкою.

---

## 3. Перевірити дані через Modbus (Python)

### ET-7017 (обидва модулі)

```
python F:\auto_telemetry\simulators\test_client.py
```

Виводить поточні raw значення та значення в мА для всіх 8 каналів кожного ET-7017.
Норма: raw від 6400 до 32000, мА від 4.00 до 20.00.

---

### ET-7284 (лічильник + частота)

`test_client.py` для ET-7284 застарілий (використовує FC03 замість FC04).
Замість нього — однорядковий Python:

```
python -c "
from pymodbus.client import ModbusTcpClient
c = ModbusTcpClient('localhost', port=5022)
c.connect()
r = c.read_input_registers(address=16, count=16, device_id=1)
regs = r.registers
for ch in range(4):
    cnt = (regs[ch*2+1] << 16) | regs[ch*2]
    frq = (regs[8+ch*2+1] << 16) | regs[8+ch*2]
    print(f'Канал {ch}: лічильник={cnt} імп, частота={frq} Гц')
c.close()
"
```

Норма для каналу 0 (speed_mps=0.5, PPM=1000):
- Лічильник зростає (~500 імп/сек)
- Частота = 500 Гц (0.5 м/с × 1000 імп/м)
- Канали 1–3: лічильник 0, частота 0 (не рухаються)

---

## Параметри симуляторів

| Симулятор | Порт | Unit ID | Що симулює |
|---|---|---|---|
| ET-7017 #1 | 5020 | 1 | 8 аналогових входів, mid-scale (~12 мА) з шумом ±500 raw |
| ET-7017 #2 | 5021 | 1 | те саме |
| ET-7284 | 5022 | 1 | лічильник каналу 0 (~500 імп/сек), канали 1–3 нерухомі |

## Modbus-адреси (для ручного тестування сторонніми клієнтами)

| Модуль | FC | Стартова адреса | Кількість реєстрів | Що містить |
|---|---|---|---|---|
| ET-7017 | 04 | 0 | 8 | AI канали 0–7 (int16) |
| ET-7284 | 04 | 16 | 16 | лічильники 0–3 + частота 4–7 (uint32, Low+High) |
