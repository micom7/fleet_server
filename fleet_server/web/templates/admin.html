{% extends "base.html" %}
{% block title %}Адмін{% endblock %}

{% block page_header %}
<div class="row mb-2">
  <div class="col-sm-12"><h1 class="m-0">Адмін-панель</h1></div>
</div>
{% endblock %}

{% block content %}
<!-- Tabs -->
<ul class="nav nav-tabs mb-3" id="adminTab">
  <li class="nav-item">
    <a class="nav-link {% if tab == 'users' %}active{% endif %}" href="/admin?tab=users">
      Користувачі
      {% set pending_count = users | selectattr('status', 'equalto', 'pending') | list | length %}
      {% if pending_count > 0 %}
      <span class="badge badge-danger ml-1">{{ pending_count }}</span>
      {% endif %}
    </a>
  </li>
  <li class="nav-item">
    <a class="nav-link {% if tab == 'vehicles' %}active{% endif %}" href="/admin?tab=vehicles">
      Авто
    </a>
  </li>
</ul>

{% if error %}
<div class="alert alert-danger alert-dismissible">
  <i class="fas fa-exclamation-circle mr-1"></i>
  Помилка при додаванні авто. Перевірте правильність VPN IP.
  <button type="button" class="close" data-dismiss="alert"><span>&times;</span></button>
</div>
{% endif %}

{% if tab == 'users' %}
<!-- USERS -->
<div class="card">
  <div class="card-body p-0">
    <table class="table table-hover table-striped mb-0">
      <thead class="thead-light">
        <tr>
          <th>Email / Ім'я</th>
          <th>Роль</th>
          <th>Статус</th>
          <th>Зареєстровано</th>
          <th></th>
        </tr>
      </thead>
      <tbody id="users-table">
        {% for u in users %}{% include "partials/user_row.html" %}{% endfor %}
      </tbody>
    </table>
  </div>
</div>

{% else %}
<!-- VEHICLES -->
<div class="card">
  <div class="card-header"><h5 class="card-title m-0">Список авто</h5></div>
  <div class="card-body p-0">
    {% if not vehicles %}
    <p class="text-muted text-center py-4">Авто не додані</p>
    {% else %}
    <table class="table table-hover mb-0">
      <thead class="thead-light">
        <tr>
          <th>Назва</th><th>VPN IP</th><th>Синхронізація</th><th>Власники</th><th>Призначити</th>
        </tr>
      </thead>
      <tbody>
        {% for v in vehicles %}
        {% include "partials/vehicle_row.html" %}
        {% endfor %}
      </tbody>
    </table>
    {% endif %}
  </div>
</div>

<!-- Додати авто -->
<div class="card">
  <div class="card-header"><h5 class="card-title m-0">Додати авто</h5></div>
  <div class="card-body">
    <form method="post" action="/web/admin/vehicles" class="form-inline">
      <div class="form-group mr-2">
        <label class="mr-1 small text-muted">Назва</label>
        <input type="text" name="name" required placeholder="Авто 1" class="form-control form-control-sm">
      </div>
      <div class="form-group mr-2">
        <label class="mr-1 small text-muted">VPN IP</label>
        <input type="text" name="vpn_ip" required placeholder="10.0.0.11" class="form-control form-control-sm" style="font-family:monospace">
      </div>
      <div class="form-group mr-2">
        <label class="mr-1 small text-muted">Порт</label>
        <input type="number" name="api_port" value="8001" class="form-control form-control-sm" style="width:80px">
      </div>
      <button type="submit" class="btn btn-success btn-sm">
        <i class="fas fa-plus mr-1"></i> Додати
      </button>
    </form>
  </div>
</div>
{% endif %}
{% endblock %}
